<script>
  function toggleForm(postId) {
    const form = document.getElementById(`form_${postId}`);
    const triangleIcon = document.getElementById(`triangle-icon-${postId}`);

    if (form.style.display === "none") {
      form.style.display = "block";
      triangleIcon.classList.remove('triangle-down');
      triangleIcon.classList.add('triangle-up');
    } else {
      form.style.display = "none";
      triangleIcon.classList.remove('triangle-up');
      triangleIcon.classList.add('triangle-down');
    }
  }
</script>

<div class="post">
  <p>目標: <%= post.target %></p>
  <p>ご褒美: <%= post.treat %></p>

  <% if post.diary.user == current_user %>
    <!-- 編集と削除ボタンを表示 -->
    <%= link_to "編集", edit_diary_post_path(post.diary, post), id: "button-edit-#{post.id}", class: "btn btn-primary" %>
    <%= link_to "削除", diary_post_path(post.diary, post), id: "button-delete-#{post.id}", data: { turbo_method: :delete, turbo_confirm: t('defaults.delete_confirm') }, class: "btn btn-danger" %>
  <% end %>

<% if post.diary.user == current_user %>
    <!-- トグルボタン -->
    <button type="button" onclick="toggleForm('<%= dom_id(post) %>')">実行したこと</button>

    <!-- 入力フォーム（最初は非表示） -->
    <div id="<%= dom_id(post, :form) %>" style="display: none;">
      <%= form_with(model: [post, PostAction.new],url: diary_post_post_actions_path(post.diary_id, post.id), local: true) do |f| %>
        <div>
          <%= f.text_area :content, placeholder: "実行したことを入力" %>
        </div>
        <div>
          <%= f.submit "保存" %>
        </div>
      <% end %>
    </div>

    <!-- 実行した内容のリスト -->
    <ul>
      <% post.post_actions.each do |action| %>
        <li><%= action.content %></li>
      <% end %>
    </ul>
  <% end %>
</div>